include ../partials/sidemenu
#content-wrapper
  link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css", integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN", crossorigin="anonymous")
  link(rel="stylesheet", href="../../../stylesheet/admin/sidemenu.css")
  link(rel="stylesheet", href="../../../stylesheet/admin/editPage.css")
  link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css', integrity='sha384-Zosz5nF2B9ObwFRdEQnBA6ZshGzP86BBdCCs89BJRsyc11TkI8qIbFmIpxqY5Ndj', crossorigin='anonymous')
  script(defer src='../../../script/admin/sidemenu.js')
  script(src='https://cdn.jsdelivr.net/npm/sweetalert2@11')
  script(src="https://code.jquery.com/jquery-3.5.1.slim.min.js", integrity="sha384-DfXdz2htPH00kS58PrEW3hmvZFEMg9Supu4T9jwmg/UplcUJOua9e+06TIzrkOnQ", crossorigin="anonymous")
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js", integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns", crossorigin="anonymous")
  style.
    .topColumns{
      height: 74.5625px;
      width:289px;
      font-size:14px;
      font-weight:400;
      
    }
    .container-fluid{
      display:flex;
      justify-content:space-evenly;
    }
    #containerFluid{
      display:flex;
      align-items:center;
    }
    #secRow{
      display:flex;
      justify-content:space-evenly;
    }
    body{
      color:#CAC5C5;
    }
   
    .orderStatus {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 5px;
      height:30%;
      align-self:right;
    }
    .orderStatus h3 {
      margin-top: 0;
    }
    .details {
      margin-top: 20px;
    }
    .details > div {
      margin-bottom: 10px;
    }
    .save {
      //- margin-top: 20px;
      margin-left:1rem;
     

    }
    .container-fluide#containerFluid .container-fluid.row.mt-4 {
      margin-bottom: 4rem;
    }
    .order.topColumns.col-4 {
      background-color: #d1e7dd67;
      color: rgb(10, 54, 34);
    }
    .order.topColumns.col-4:nth-child(2) {
      background-color: #f8d7da84;
      color: rgb(88, 21, 28);
    }
    .order.topColumns.col-4:nth-child(3) {
      background-color: #fff3cd84;
      color: rgb(102, 77, 3);
    }
    .order.topColumns.col-4:nth-child(4) {
      background-color: #cff4fc56;
      color: rgb(5, 81, 96);
    }

    .product-info.row {
      margin-left: 1rem;
    }
    .orderStatus.col-4 {
      margin-left: 1rem;
    }
    .product-info{
      display:flex;
      justify-content:space-evenly;

    }
    .status.pending {
          //- background-color: #ffc0cb;
          color: #d9534f;
      }
      
      .status.processing {
          //- background-color: #ffecb3;
          color: #f0ad4e;
      }
      
      .status.shipped {
          //- background-color: #b2dfdb;
          color: #4caf50;
      }
      
      .status.delivered {
          //- background-color: #c8e6c9;
          color: #2e7d32;
      }
      
      .status.cancelled {
          //- background-color: #f44336;
          color: #ffffff;
      }
  .container-fluid#containerFluid.row.mt-4(style="margin-bottom:4rem;")
    .order.topColumns.col-4
      h5.ms-2.mt-2 Order created at
      p.ms-2(style="font-size:16px;font-weight:400;") #{createdDate}
    .order.topColumns.col-4
      h5.ms-2.mt-2  Name 
      p.ms-2(style="font-size:16px;font-weight:400;") #{user.name}
    .order.topColumns.col-4
      h5.ms-2.mt-2  Email
      p.ms-2(style="font-size:16px;font-weight:400;") #{user.email}
    .order.topColumns.col-4
      h5.ms-2.mt-2  Country 
      p.ms-2(style="font-size:16px;font-weight:400;") #{order.shipping_address.country}
  #secRow.row.mt-4.gap-2(style=" margin-bottom:3rem; background: #0c241b5b; padding:1rem;  ")
    .delivery-address.col-4(style="background:rgba(12, 37, 28, 0.1);")
      .address-title
        h2 Delivery Address
        //- button Edit
      .address-details
        span Address:
        span #{order.shipping_address.address}
      .address-details
        span City:
        span #{order.shipping_address.city}
      .address-details
        span State:
        span #{order.shipping_address.state}
      .address-details
        span Zip Code:
        span #{order.shipping_address.zip_code}
      .address-details
        span Country:
        span #{order.shipping_address.country}
    .billing-address.col-4(style="background:rgba(12, 37, 28, 0.1);")
      .address-title
        h2 Billing Address
        //- button Edit
      .address-details
        span Address:
        span #{order.billing_address.address}
      .address-details
        span City:
        span #{order.billing_address.city}
      .address-details
        span State:
        span #{order.billing_address.state}
      .address-details
        span Zip Code:
        span #{order.billing_address.zip_code}
      .address-details
        span Country:
        span #{order.billing_address.country}
    
#thirdRow.mb-5
  .product-info.row
    .info-section.col-6
      table
        h2.ms-4 Product Info
        thead
          tr
            th Product
            th Unit Price
            th Quantity
            th Total
            th Status
        tbody
          each product in order.items
            tr
              td #{product.name}
              td #{product.price}
              td #{product.quantity}
              td $#{product.quantity * product.price}
              td 
                if order.status === 'pending'
                  span.status.pending Pending
                else if order.status === 'processing'
                  span.status.processing Processing
                else if order.status === 'shipped'
                  span.status.shipped Shipped
                else if order.status === 'delivered'
                  span.status.delivered Delivered
                else if order.status === 'cancelled'
                  span.status.cancelled Cancelled
    .orderStatus.col-4(style="margin-top:3rem;")
      h3 Order Status
      .details(style="background:rgba(255, 255, 255, 0.1);")
        .orderId.ms-1 Order ID
        p.ms-1= order._id
        .status.ms-1 Order Status
          select#statusSelect(name="status" style='width: 50%; margin-left:2rem;'  data-id=order._id)
            option(value="pending" selected=order.status=='pending') pending
            option(value="processing" selected=order.status=='processing') processing
            option(value="shipped" selected=order.status=='shipped') shipped
            option(value="delivered" selected=order.status=='delivered') delivered
          a.btn.text-primary.border-primary#statusSave(href='#' style=" margin-bottom:5px; margin-left:2rem;") Save  

  script.
    document.addEventListener('DOMContentLoaded', function () {
      const saveButton = document.getElementById('statusSave');

      saveButton.addEventListener('click', function (event) {
        event.preventDefault(); // Prevent default behavior of the anchor tag

        // Get the selected status from the dropdown
        const statusSelect = document.getElementById('statusSelect');
        const orderId = statusSelect.dataset.id
        const selectedStatus = statusSelect.value;
        console.log(selectedStatus)

        // Fetch PUT request
        fetch(`/admin/orders/${orderId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ status: selectedStatus }),
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          // Handle successful response
          window.location.href = "/admin/orders";
        })
        .catch(error => {
          // Handle error
          console.error('There was a problem with the fetch operation:', error);
        });
      });
    });


